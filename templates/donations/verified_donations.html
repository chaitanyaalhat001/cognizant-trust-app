{% extends 'base.html' %}
{% load currency_filters %}

{% block title %}Verified Donations - CognizantTrust{% endblock %}

{% block content %}
<style>
    /* Fresh start - IDENTICAL to welfare activities styling */
    .stats-card .stats-number {
        white-space: nowrap;
        word-break: normal;
        overflow-wrap: normal;
        font-size: 2.2rem !important;
        font-weight: 800 !important;
        margin-bottom: 0.5rem !important;
    }
    
    .stats-card .stats-number.currency-amount {
        font-size: 1.4rem !important;
        padding: 0 10px;
    }
    
    .stats-card {
        min-width: 180px;
        overflow: visible;
        padding: var(--space-lg) var(--space-sm) !important;
        border-radius: 15px !important;
        transition: all 0.3s ease !important;
    }
    
    .stats-card:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15) !important;
    }
    
    /* Enhanced stats section styling - ELIMINATE WHITE SPACE */
    section.bg-light {
        position: relative !important;
        margin-top: -1px !important;
        padding-top: 2rem !important;
        z-index: 1 !important;
    }
    
    /* Seamless connection between header and stats */
    .hero-section {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }
    
    /* Force remove any white space between sections */
    body {
        margin: 0 !important;
        padding: 0 !important;
    }
    
    /* Remove any container margins that might cause white space */
    .container {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }
    
    /* Ensure no spacing before statistics section */
    section.bg-light::before {
        content: none !important;
    }
    
    .stats-label {
        font-size: 0.875rem !important;
        color: #64748b !important;
        font-weight: 600 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
    }
    
    /* Table container with gradient top border */
    .table-container {
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(37, 99, 235, 0.1);
        position: relative;
    }
    
    .table-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #2563eb 0%, #00d4ff 25%, #7c3aed 50%, #ff6b9d 75%, #f39c12 100%);
        z-index: 1;
    }
    
    /* Enhanced table headers - DARK MODE COMPATIBLE */
    .table th {
        font-weight: 700;
        border: none;
        padding: 1.25rem 1rem;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
    }
    
    /* Table cells - DARK MODE COMPATIBLE */
    .table td {
        padding: 1.25rem 1rem;
        vertical-align: middle;
    }
    
    /* Enhanced table row interactions - DARK MODE COMPATIBLE */
    .table tbody tr {
        animation: fadeInUp 0.6s ease forwards;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-left: 4px solid transparent;
    }
    
    .table tbody tr:hover {
        transform: translateY(-2px) scale(1.005);
        border-left: 4px solid var(--cognizant-orange);
    }
    
    /* LIGHT MODE ONLY STYLES */
    html:not([data-theme="dark"]) .table th {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 50%, #7c3aed 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }
    
    html:not([data-theme="dark"]) .table th::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #00d4ff, #ff6b9d, #f39c12);
        border-radius: 0 0 8px 8px;
    }
    
    html:not([data-theme="dark"]) .table td {
        border-color: #e5e7eb;
        border-bottom: 1px solid #f1f5f9;
    }
    
    html:not([data-theme="dark"]) .table tbody tr:hover {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
    }
    
    /* Donor info styling */
    .donor-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .donor-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #2563eb 0%, #00d4ff 50%, #7c3aed 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1rem;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        border: 3px solid white;
        position: relative;
    }
    
    .donor-avatar::before {
        content: '';
        position: absolute;
        inset: -3px;
        border-radius: 50%;
        padding: 3px;
        background: linear-gradient(135deg, #00d4ff, #ff6b9d, #f39c12);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: xor;
        -webkit-mask-composite: xor;
    }
    
    .donor-name {
        font-weight: 600;
        color: #1e293b;
        font-size: 0.925rem;
    }
    
    .donor-email {
        font-size: 0.8rem;
        color: #64748b;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        padding: 0.2rem 0.5rem;
        border-radius: 8px;
        border-left: 2px solid rgba(37, 99, 235, 0.2);
    }
    
    /* Enhanced amount display - EXACT MATCH TO WELFARE */
    .amount-display {
        font-size: 1.25rem;
        font-weight: 800;
        background: linear-gradient(135deg, #f39c12, #ff6b9d);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Purpose text styling - EXACT MATCH TO WELFARE ACTIVITY DESCRIPTION */
    .purpose-text {
        max-width: 280px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 0.875rem;
        color: #64748b;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 0.5rem 0.875rem;
        border-radius: 12px;
        border-left: 3px solid rgba(243, 156, 18, 0.4);
        transition: all 0.3s ease;
        border: 1px solid rgba(243, 156, 18, 0.2);
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .purpose-text:hover {
        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
        border-left-color: #f39c12;
        border-color: rgba(243, 156, 18, 0.3);
        cursor: help;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Date styling */
    .date-display {
        font-weight: 500;
        color: #1e293b;
        font-size: 0.9rem;
    }
    
    .date-time {
        font-size: 0.8rem;
        color: #64748b;
    }
    
    /* Enhanced status badges */
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.875rem;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 2px solid;
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        white-space: nowrap;
    }
    
    .status-recorded {
        background: linear-gradient(135deg, #10b981, #34d399);
        color: white;
        border-color: #10b981;
        animation: pulse-success 2s infinite;
    }
    
    .status-pending {
        background: linear-gradient(135deg, #f59e0b, #f97316);
        color: white;
        border-color: #f59e0b;
        animation: pulse-warning 2s infinite;
    }
    
    /* Enhanced Etherscan links */
    .etherscan-link {
        background: linear-gradient(135deg, #2563eb, #7c3aed);
        color: white;
        text-decoration: none;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 25px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }
    
    .etherscan-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
        color: white;
        text-decoration: none;
    }
    
    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes pulse-success {
        0%, 100% { box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); }
        50% { box-shadow: 0 4px 20px rgba(16, 185, 129, 0.5); }
    }
    
    @keyframes pulse-warning {
        0%, 100% { box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3); }
        50% { box-shadow: 0 4px 20px rgba(245, 158, 11, 0.5); }
    }
    
    /* Enhanced staggered animation delays - EXACT MATCH TO WELFARE */
    .table tbody tr:nth-child(1) { animation-delay: 0.1s; opacity: 0; }
    .table tbody tr:nth-child(2) { animation-delay: 0.15s; opacity: 0; }
    .table tbody tr:nth-child(3) { animation-delay: 0.2s; opacity: 0; }
    .table tbody tr:nth-child(4) { animation-delay: 0.25s; opacity: 0; }
    .table tbody tr:nth-child(5) { animation-delay: 0.3s; opacity: 0; }
    .table tbody tr:nth-child(6) { animation-delay: 0.35s; opacity: 0; }
    .table tbody tr:nth-child(7) { animation-delay: 0.4s; opacity: 0; }
    .table tbody tr:nth-child(8) { animation-delay: 0.45s; opacity: 0; }
    .table tbody tr:nth-child(9) { animation-delay: 0.5s; opacity: 0; }
    .table tbody tr:nth-child(10) { animation-delay: 0.55s; opacity: 0; }
    
    /* Enhanced hover effects */
    .table-container::after {
        content: '';
        position: absolute;
        inset: -2px;
        background: linear-gradient(45deg, #2563eb, #00d4ff, #7c3aed, #ff6b9d, #f39c12);
        border-radius: 22px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .table-container:hover::after {
        opacity: 0.3;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
        .stats-card .stats-number.currency-amount {
            font-size: 1.2rem !important;
        }
        .stats-card {
            min-width: 160px;
        }
        .table th, .table td {
            padding: 0.75rem 0.5rem;
            font-size: 0.875rem;
        }
        .purpose-text {
            max-width: 200px;
            font-size: 0.8rem;
            padding: 0.375rem;
        }
        .donor-avatar {
            width: 40px;
            height: 40px;
            font-size: 0.875rem;
        }
        .amount-display {
            font-size: 1.1rem;
        }
    }
    
    @media (max-width: 576px) {
        .stats-card .stats-number.currency-amount {
            font-size: 1.0rem !important;
        }
        .stats-card {
            min-width: 140px;
            padding: 1rem 0.5rem !important;
        }
        .table-container {
            margin: 0 -15px;
            border-radius: 15px;
        }
        .table th, .table td {
            padding: 0.75rem 0.25rem;
            font-size: 0.8rem;
        }
        .purpose-text {
            max-width: 150px;
            font-size: 0.75rem;
        }
        .donor-avatar {
            width: 36px;
            height: 36px;
            font-size: 0.8rem;
        }
        .amount-display {
            font-size: 1rem;
        }
        .donor-name {
            font-size: 0.85rem;
        }
        .donor-email {
            font-size: 0.7rem;
            padding: 0.1rem 0.3rem;
        }
        .etherscan-link {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }
        .status-badge {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
    }
</style>

<!-- Header Section -->
<div class="hero-section bg-cognizant-gradient text-white">
    <div class="container">
        <div class="row align-items-center py-5">
            <div class="col-lg-8">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-heart me-3 text-cognizant-orange"></i>
                    Verified Donations
                </h1>
                <p class="lead mb-4">
                    Complete transparency through blockchain verification of all donations received
                </p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="/audit/" class="btn btn-outline-light btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>
                    Back to Audit Trail
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Section - NO GAP -->
<section class="pb-5 bg-secondary" style="margin-top: -1px; padding-top: 2rem; position: relative; z-index: 1;">
    <div class="container">
        <div class="row g-3">
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number text-cognizant-blue">{{ total_verified_donations }}</div>
                    <div class="stats-label">Verified Donations</div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number currency-amount text-cognizant-orange">{{ total_donated_amount|inr_format }}</div>
                    <div class="stats-label">Total Amount</div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number text-cognizant-green">{{ recorded_donations_count }}</div>
                    <div class="stats-label">On Blockchain</div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number text-cognizant-purple">100%</div>
                    <div class="stats-label">Verified</div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number text-cognizant-teal">Public</div>
                    <div class="stats-label">Transparency</div>
                </div>
            </div>
            <div class="col-6 col-md-4 col-xl-2">
                <div class="stats-card">
                    <div class="stats-number text-cognizant-blue">100%</div>
                    <div class="stats-label">Accountability</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Donations Table -->
<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-cognizant-navy mb-0">
                <i class="fas fa-heart me-2 text-cognizant-orange"></i>
                All Verified Donations
            </h3>
            <div class="d-flex gap-2">
                <button class="btn btn-cognizant-secondary btn-sm" onclick="window.location.reload()">
                    <i class="fas fa-sync-alt me-1"></i>
                    Refresh
                </button>
                <a href="https://sepolia.etherscan.io/address/0x61Cffd0c2c1d2A2ca83BcCCFfA7C6F8C3e2d1B8c" target="_blank" class="btn btn-outline-primary btn-sm">
                    <i class="fab fa-ethereum me-1"></i>
                    View Contract
                </a>
            </div>
        </div>

        {% if donations %}
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover mb-0" id="verified-donations-table">
                    <thead>
                        <tr>
                            <th>Donor</th>
                            <th>Amount</th>
                            <th>Purpose</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Blockchain</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for donation in donations %}
                        <tr>
                            <td>
                                <div class="donor-info">
                                    <div class="donor-avatar">
                                        {{ donation.donor_name|first|upper }}
                                    </div>
                                    <div>
                                        <div class="donor-name">{{ donation.donor_name }}</div>
                                        <div class="donor-email">{{ donation.donor_email|default:"Anonymous" }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="amount-display">{{ donation.amount|inr_format }}</span>
                            </td>
                            <td>
                                <div class="purpose-text">
                                    {{ donation.purpose|truncatechars:80 }}
                                </div>
                            </td>
                            <td>
                                <div class="date-display">{{ donation.created_at|date:"M d, Y" }}</div>
                                <div class="date-time">{{ donation.created_at|time:"g:i A" }}</div>
                            </td>
                            <td>
                                {% if donation.is_recorded_on_blockchain %}
                                    <span class="status-badge status-recorded">
                                        <i class="fas fa-check me-1"></i>
                                        Verified
                                    </span>
                                {% else %}
                                    <span class="status-badge status-pending">
                                        <i class="fas fa-clock me-1"></i>
                                        Pending
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if donation.blockchain_tx_hash %}
                                    <a href="https://sepolia.etherscan.io/tx/{{ donation.blockchain_tx_hash|add_hex_prefix }}" 
                                       target="_blank" class="etherscan-link">
                                        <i class="fab fa-ethereum me-1"></i>
                                        View Transaction
                                    </a>
                                {% else %}
                                    <span class="text-gray-400">
                                        <i class="fas fa-minus"></i>
                                        Not recorded
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-heart text-gray-300" style="font-size: 4rem;"></i>
            <h4 class="text-gray-500 mt-3">No verified donations found</h4>
            <p class="text-gray-400">All blockchain-verified donations will appear here</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Info Section -->
<section class="py-5 bg-secondary">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="card border-0 shadow-lg">
                    <div class="card-body p-4">
                        <h5 class="card-title text-cognizant-navy mb-3">
                            <i class="fas fa-info-circle me-2 text-cognizant-blue"></i>
                            Blockchain Verification Info
                        </h5>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <h6 class="text-cognizant-navy">What's Verified:</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>Donor identity</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Donation amount</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Purpose/cause</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Timestamp</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-cognizant-navy">How to Verify:</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-external-link-alt text-primary me-2"></i>Click "View Transaction"</li>
                                    <li><i class="fas fa-search text-primary me-2"></i>Check Etherscan details</li>
                                    <li><i class="fas fa-shield-alt text-primary me-2"></i>Verify on blockchain</li>
                                    <li><i class="fas fa-lock text-primary me-2"></i>Immutable record</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
    // Apply proper table styling based on theme for verified donations
    function applyVerifiedDonationsTableTheme() {
        const theme = document.documentElement.getAttribute('data-theme');
        const tableRows = document.querySelectorAll('#verified-donations-table tbody tr');
        const tableCells = document.querySelectorAll('#verified-donations-table tbody td');
        
        if (theme === 'dark') {
            // Dark mode styling
            tableRows.forEach(row => {
                row.style.setProperty('background-color', '#1f1f1f', 'important');
                row.style.setProperty('background', '#1f1f1f', 'important');
            });
            
            tableCells.forEach(cell => {
                cell.style.setProperty('background-color', '#1f1f1f', 'important');
                cell.style.setProperty('background', '#1f1f1f', 'important');
                cell.style.setProperty('color', '#e1e1e1', 'important');
            });
        } else {
            // Light mode styling - remove forced styles to let CSS take over
            tableRows.forEach(row => {
                row.style.removeProperty('background-color');
                row.style.removeProperty('background');
            });
            
            tableCells.forEach(cell => {
                cell.style.removeProperty('background-color');
                cell.style.removeProperty('background');
                cell.style.removeProperty('color');
            });
        }
    }

    // Run on page load and theme change
    document.addEventListener('DOMContentLoaded', applyVerifiedDonationsTableTheme);

    // Listen for theme changes
    new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                applyVerifiedDonationsTableTheme();
            }
        });
    }).observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
    });
</script>
{% endblock %} 